<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Set 2 Exploratory Analysis of Time Series Data | DS809</title>
  <meta name="description" content="Course materials for DS809, Spring 2024." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Set 2 Exploratory Analysis of Time Series Data | DS809" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Course materials for DS809, Spring 2024." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Set 2 Exploratory Analysis of Time Series Data | DS809" />
  
  <meta name="twitter:description" content="Course materials for DS809, Spring 2024." />
  

<meta name="author" content="David Reynolds" />


<meta name="date" content="2025-02-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="arma.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">UNH DS809</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Course Info</a></li>
<li class="chapter" data-level="2" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html"><i class="fa fa-check"></i><b>2</b> Exploratory Analysis of Time Series Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#time-series-data"><i class="fa fa-check"></i><b>2.1</b> Time Series Data</a></li>
<li class="chapter" data-level="2.2" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#time-series-eda"><i class="fa fa-check"></i><b>2.2</b> Time Series EDA</a></li>
<li class="chapter" data-level="2.3" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#classical-regression"><i class="fa fa-check"></i><b>2.3</b> Classical Regression</a></li>
<li class="chapter" data-level="2.4" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#noise-processes"><i class="fa fa-check"></i><b>2.4</b> Noise Processes</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#white-noise"><i class="fa fa-check"></i><b>2.4.1</b> White noise</a></li>
<li class="chapter" data-level="2.4.2" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#random-walk"><i class="fa fa-check"></i><b>2.4.2</b> Random Walk</a></li>
<li class="chapter" data-level="2.4.3" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#ar-process"><i class="fa fa-check"></i><b>2.4.3</b> AR Process</a></li>
<li class="chapter" data-level="2.4.4" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#exercise"><i class="fa fa-check"></i><b>2.4.4</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#measures-of-dependence"><i class="fa fa-check"></i><b>2.5</b> Measures of Dependence</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#autocovariance"><i class="fa fa-check"></i><b>2.5.1</b> Autocovariance</a></li>
<li class="chapter" data-level="2.5.2" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#autocorrelation"><i class="fa fa-check"></i><b>2.5.2</b> Autocorrelation</a></li>
<li class="chapter" data-level="2.5.3" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#exercise-1"><i class="fa fa-check"></i><b>2.5.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#stationarity"><i class="fa fa-check"></i><b>2.6</b> Stationarity</a></li>
<li class="chapter" data-level="2.7" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#estimation"><i class="fa fa-check"></i><b>2.7</b> Estimation</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#mean"><i class="fa fa-check"></i><b>2.7.1</b> Mean</a></li>
<li class="chapter" data-level="2.7.2" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#autocovariance-1"><i class="fa fa-check"></i><b>2.7.2</b> Autocovariance</a></li>
<li class="chapter" data-level="2.7.3" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#autocorrelation-1"><i class="fa fa-check"></i><b>2.7.3</b> Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#lab-1"><i class="fa fa-check"></i><b>2.8</b> Lab 1</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="arma.html"><a href="arma.html"><i class="fa fa-check"></i><b>3</b> ARMA</a>
<ul>
<li class="chapter" data-level="3.1" data-path="arma.html"><a href="arma.html#operators"><i class="fa fa-check"></i><b>3.1</b> Operators</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="arma.html"><a href="arma.html#backshift-operator"><i class="fa fa-check"></i><b>3.1.1</b> Backshift operator</a></li>
<li class="chapter" data-level="3.1.2" data-path="arma.html"><a href="arma.html#the-difference-operator"><i class="fa fa-check"></i><b>3.1.2</b> The difference operator</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="arma.html"><a href="arma.html#autoregressive-ar-models"><i class="fa fa-check"></i><b>3.2</b> Autoregressive (AR) models</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="arma.html"><a href="arma.html#ar1-model"><i class="fa fa-check"></i><b>3.2.1</b> AR(1) Model</a></li>
<li class="chapter" data-level="3.2.2" data-path="arma.html"><a href="arma.html#ar-stationarity"><i class="fa fa-check"></i><b>3.2.2</b> AR Stationarity</a></li>
<li class="chapter" data-level="3.2.3" data-path="arma.html"><a href="arma.html#autocorrelation-2"><i class="fa fa-check"></i><b>3.2.3</b> Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="arma.html"><a href="arma.html#moving-average-ma-models"><i class="fa fa-check"></i><b>3.3</b> Moving Average (MA) models</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="arma.html"><a href="arma.html#examples-of-maq-models"><i class="fa fa-check"></i><b>3.3.1</b> Examples of MA(<em>q</em>) models</a></li>
<li class="chapter" data-level="3.3.2" data-path="arma.html"><a href="arma.html#ma1-model"><i class="fa fa-check"></i><b>3.3.2</b> MA(1) Model</a></li>
<li class="chapter" data-level="3.3.3" data-path="arma.html"><a href="arma.html#invertibility"><i class="fa fa-check"></i><b>3.3.3</b> Invertibility</a></li>
<li class="chapter" data-level="3.3.4" data-path="arma.html"><a href="arma.html#autocorrelation-3"><i class="fa fa-check"></i><b>3.3.4</b> Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="arma.html"><a href="arma.html#pacf"><i class="fa fa-check"></i><b>3.4</b> PACF</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="arma.html"><a href="arma.html#definition"><i class="fa fa-check"></i><b>3.4.1</b> Definition</a></li>
<li class="chapter" data-level="3.4.2" data-path="arma.html"><a href="arma.html#ar1-pacf"><i class="fa fa-check"></i><b>3.4.2</b> AR(1) PACF</a></li>
<li class="chapter" data-level="3.4.3" data-path="arma.html"><a href="arma.html#pacf-for-arp"><i class="fa fa-check"></i><b>3.4.3</b> PACF for AR(p)</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="arma.html"><a href="arma.html#ar-estimation"><i class="fa fa-check"></i><b>3.5</b> AR Estimation</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="arma.html"><a href="arma.html#yule-walker-equations"><i class="fa fa-check"></i><b>3.5.1</b> Yule-Walker Equations</a></li>
<li class="chapter" data-level="3.5.2" data-path="arma.html"><a href="arma.html#example"><i class="fa fa-check"></i><b>3.5.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="arma.html"><a href="arma.html#arma-models"><i class="fa fa-check"></i><b>3.6</b> ARMA models</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="arma.html"><a href="arma.html#psi-representation"><i class="fa fa-check"></i><b>3.6.1</b> <span class="math inline">\(\psi\)</span> representation</a></li>
<li class="chapter" data-level="3.6.2" data-path="arma.html"><a href="arma.html#arma11"><i class="fa fa-check"></i><b>3.6.2</b> ARMA(1,1)</a></li>
<li class="chapter" data-level="3.6.3" data-path="arma.html"><a href="arma.html#forecasting"><i class="fa fa-check"></i><b>3.6.3</b> Forecasting</a></li>
<li class="chapter" data-level="3.6.4" data-path="arma.html"><a href="arma.html#forecast-errors"><i class="fa fa-check"></i><b>3.6.4</b> Forecast Errors</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="arma.html"><a href="arma.html#lab-2"><i class="fa fa-check"></i><b>3.7</b> Lab 2</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arima.html"><a href="arima.html#stationarity-1"><i class="fa fa-check"></i><b>4.1</b> Stationarity</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="arima.html"><a href="arima.html#visual-test"><i class="fa fa-check"></i><b>4.1.1</b> Visual Test</a></li>
<li class="chapter" data-level="4.1.2" data-path="arima.html"><a href="arima.html#unit-root-tests"><i class="fa fa-check"></i><b>4.1.2</b> Unit Root Tests</a></li>
<li class="chapter" data-level="4.1.3" data-path="arima.html"><a href="arima.html#dickey-fuller-test-df"><i class="fa fa-check"></i><b>4.1.3</b> Dickey Fuller Test (DF)</a></li>
<li class="chapter" data-level="4.1.4" data-path="arima.html"><a href="arima.html#augmented-df-test"><i class="fa fa-check"></i><b>4.1.4</b> Augmented DF Test</a></li>
<li class="chapter" data-level="4.1.5" data-path="arima.html"><a href="arima.html#adf-tseriesadf.test"><i class="fa fa-check"></i><b>4.1.5</b> ADF: <code>tseries::adf.test()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="arima.html"><a href="arima.html#differencing-nabla"><i class="fa fa-check"></i><b>4.2</b> Differencing <span class="math inline">\(\nabla\)</span></a></li>
<li class="chapter" data-level="4.3" data-path="arima.html"><a href="arima.html#arima-models"><i class="fa fa-check"></i><b>4.3</b> ARIMA Models</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="arima.html"><a href="arima.html#arima111"><i class="fa fa-check"></i><b>4.3.1</b> ARIMA(1,1,1)</a></li>
<li class="chapter" data-level="4.3.2" data-path="arima.html"><a href="arima.html#real-data-example"><i class="fa fa-check"></i><b>4.3.2</b> Real Data Example</a></li>
<li class="chapter" data-level="4.3.3" data-path="arima.html"><a href="arima.html#model-selection-fitting"><i class="fa fa-check"></i><b>4.3.3</b> Model Selection/ Fitting</a></li>
<li class="chapter" data-level="4.3.4" data-path="arima.html"><a href="arima.html#model-selection---automated"><i class="fa fa-check"></i><b>4.3.4</b> Model Selection - automated</a></li>
<li class="chapter" data-level="4.3.5" data-path="arima.html"><a href="arima.html#model-checking"><i class="fa fa-check"></i><b>4.3.5</b> Model Checking</a></li>
<li class="chapter" data-level="4.3.6" data-path="arima.html"><a href="arima.html#forecasting-1"><i class="fa fa-check"></i><b>4.3.6</b> Forecasting</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="arima.html"><a href="arima.html#sarima"><i class="fa fa-check"></i><b>4.4</b> SARIMA</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="arima.html"><a href="arima.html#unpacking-notation"><i class="fa fa-check"></i><b>4.4.1</b> Unpacking Notation</a></li>
<li class="chapter" data-level="4.4.2" data-path="arima.html"><a href="arima.html#data-example"><i class="fa fa-check"></i><b>4.4.2</b> Data Example</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="arima.html"><a href="arima.html#lab-3"><i class="fa fa-check"></i><b>4.5</b> Lab 3</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="review-mild-extensions.html"><a href="review-mild-extensions.html"><i class="fa fa-check"></i><b>5</b> Review/ Mild Extensions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="review-mild-extensions.html"><a href="review-mild-extensions.html#linear-filtering"><i class="fa fa-check"></i><b>5.1</b> <em>Linear Filtering</em></a></li>
<li class="chapter" data-level="5.2" data-path="review-mild-extensions.html"><a href="review-mild-extensions.html#ar-parameter-constraints"><i class="fa fa-check"></i><b>5.2</b> <em>AR Parameter Constraints</em></a></li>
<li class="chapter" data-level="5.3" data-path="review-mild-extensions.html"><a href="review-mild-extensions.html#ma-parameter-constraints"><i class="fa fa-check"></i><b>5.3</b> <em>MA Parameter Constraints</em></a></li>
<li class="chapter" data-level="5.4" data-path="review-mild-extensions.html"><a href="review-mild-extensions.html#sarima-models"><i class="fa fa-check"></i><b>5.4</b> <em>SARIMA models</em></a></li>
<li class="chapter" data-level="5.5" data-path="review-mild-extensions.html"><a href="review-mild-extensions.html#residuals-check"><i class="fa fa-check"></i><b>5.5</b> <em>Residuals check</em></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="volatility-models.html"><a href="volatility-models.html"><i class="fa fa-check"></i><b>6</b> Volatility Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="volatility-models.html"><a href="volatility-models.html#arch1"><i class="fa fa-check"></i><b>6.1</b> ARCH(1)</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="volatility-models.html"><a href="volatility-models.html#statistical-properties"><i class="fa fa-check"></i><b>6.1.1</b> Statistical Properties</a></li>
<li class="chapter" data-level="6.1.2" data-path="volatility-models.html"><a href="volatility-models.html#simulation-model-fit"><i class="fa fa-check"></i><b>6.1.2</b> Simulation/ Model Fit</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="volatility-models.html"><a href="volatility-models.html#garch11"><i class="fa fa-check"></i><b>6.2</b> GARCH(1,1)</a></li>
<li class="chapter" data-level="6.3" data-path="volatility-models.html"><a href="volatility-models.html#fgarchgarchfit"><i class="fa fa-check"></i><b>6.3</b> <code>fGarch::garchFit</code></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DS809</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory-analysis-of-time-series-data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Set 2</span> Exploratory Analysis of Time Series Data<a href="exploratory-analysis-of-time-series-data.html#exploratory-analysis-of-time-series-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="time-series-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Time Series Data<a href="exploratory-analysis-of-time-series-data.html#time-series-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>A time series is an ordered sequence of observations, where the ordering is through time.</p></li>
<li><p>Time series data creates unique problems for statistical modeling and inference.</p>
<ul>
<li>Traditional inference assumes that observations (data) are independent and identically distributed. Adjacent data points in time series data are not necessarily independent (uncorrelated).</li>
<li>Most time series models aim to exploit such dependence. For instance, yesterday’s demand of a product may tell us something about today’s
demand of a product.</li>
</ul></li>
<li><p>There are several different ways to represent time series data in R.</p></li>
<li><p>We will use the <code>tidyverse</code> family of packages extensively in this class. This package includes the <code>lubridate</code> package, which includes functions to work with date-times.</p></li>
<li><p>Two of the most common ways to represent time series data are using data frames in which one of the variables is a time object (such as POSIXct or Date) or using a time series object.</p></li>
</ul>
</div>
<div id="time-series-eda" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Time Series EDA<a href="exploratory-analysis-of-time-series-data.html#time-series-eda" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first thing to do in any data analysis is exploratory data analysis (EDA). Graphs enable many features of the data to be visualized, including patterns, unusual observations, changes over time, and relationships between variables. The features that are seen in plots of the data can then be incorporated into statistical models.</p>
<p>R has several systems for making graphs. We will primarily use ggplot2, which is among the set of tidyverse packages and is one of the most versatile systems for plotting. We will use a data set from Kayak to motivate our analysis.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="exploratory-analysis-of-time-series-data.html#cb1-1" tabindex="-1"></a>conversions <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/conversions.csv&quot;</span>)</span>
<span id="cb1-2"><a href="exploratory-analysis-of-time-series-data.html#cb1-2" tabindex="-1"></a>  <span class="co">#read.csv(&quot;https://raw.githubusercontent.com/dbreynol/DS809/main/data/conversions.csv&quot;)</span></span>
<span id="cb1-3"><a href="exploratory-analysis-of-time-series-data.html#cb1-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(conversions))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">datestamp</th>
<th align="left">country_code</th>
<th align="left">marketing_channel</th>
<th align="right">conversions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2014-11-01</td>
<td align="left">be</td>
<td align="left">Display Ads</td>
<td align="right">1174</td>
</tr>
<tr class="even">
<td align="left">2014-11-01</td>
<td align="left">be</td>
<td align="left">KAYAK Deals Email</td>
<td align="right">57</td>
</tr>
<tr class="odd">
<td align="left">2014-11-01</td>
<td align="left">be</td>
<td align="left">Search Engine Ads</td>
<td align="right">1122</td>
</tr>
<tr class="even">
<td align="left">2014-11-01</td>
<td align="left">be</td>
<td align="left">Search Engine Results</td>
<td align="right">976</td>
</tr>
<tr class="odd">
<td align="left">2014-11-01</td>
<td align="left">fi</td>
<td align="left">Display Ads</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">2014-11-01</td>
<td align="left">fi</td>
<td align="left">Search Engine Results</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>This dataset contains information on the total number of daily conversions by country and marketing channel. Let us focus our analysis on the US and first visualize the number of conversions by day.</p>
<p><img src="series_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>This plot contains a lot of useful information. To gain insight into how conversions depend on marketing channel, we can use facets. Facets are subplots that display a time series for each marketing channel.</p>
<p><img src="series_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Display ads and search engine ads are the dominant marketing channels. Both have a regular pattern that is likely a function of the day of week, with a higher number of conversions during weekdays as compared with weekends. We can explore this feature by aggregating over each weekday and visualizing how the distribution of conversions changes by day.</p>
<p><img src="series_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Clearly, there are significant changes in the mean level of conversions across the week. This is a form of seasonality. It may be useful to see what the data look like when this weekday effect is removed. To do so, we could visualize the residuals from the following linear regression model:</p>
<p><span class="math display">\[\begin{align}
\hat{\text{conversions}} = \hat{\beta}_0 + \sum_{j=2}^7 \bigg( \hat{\beta}_j \times 1(\text{weekday = j}) \bigg),
\end{align}\]</span></p>
<p>where <span class="math inline">\(j\)</span> indexes the day of week. The residuals from this model consist of each observation minus the mean for that particular weekday.</p>
<p><img src="series_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>This allows us to more clearly see the trend across the date range, removing the effect of the weekly pattern.</p>
</div>
<div id="classical-regression" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Classical Regression<a href="exploratory-analysis-of-time-series-data.html#classical-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Given that regression is already in our tool kit, we will use it as our first method to model a time series. Let us assume that we have some output or dependent time series, say, <span class="math inline">\(x_t\)</span> , for <span class="math inline">\(t = 1, \ldots,n\)</span>, that is being influenced by a collection of possible inputs, say, <span class="math inline">\(z_{t1}, z_{t2}, \ldots, z_{tq}\)</span>, where we regard the inputs as fixed and known.</p>
<p>We will look at monthly Australian electricity production (the <code>fma::elec</code> dataframe). The data is shown below.</p>
<p><img src="series_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Let us fit two models to this data, one where we use time as the independent variable. This estimates a linear trend. In the other, we will try to capture some of the obvious seasonality in the data.</p>
<p><span class="math display">\[\begin{align}
y_t &amp;= \beta_0 + \beta_1 t + w_t \\
y_t &amp;= \beta_0 + \beta_1 t + \beta_2 \times ({2\pi \cos(t)}) + w_t
\end{align}\]</span></p>
<p>The fits from these two models are shown below.</p>
<p><img src="series_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Clearly, model 2 offers a superior fit as compared with model 1. In fact, this model explains about 95% of the variation in electricity production. To check the validity of the model, let us examine the residuals across the range of time, <span class="math inline">\(t\)</span>.</p>
<p><img src="series_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>One of the assumptions of the linear regression model is that the errors are independent and identically distributed. That is, for the model,</p>
<p><span class="math display">\[\begin{align}
y = X \beta + \epsilon,
\end{align}\]</span></p>
<p>The error vector, <span class="math inline">\(\epsilon \sim N(0, \sigma^2)\)</span>, consists of independent and identically distributed random variables. This implies that there is no correlation structure to the residuals. One way to check that this is true is to check for the absence of correlation in the observed residuals. What does the figure above indicate about the validity of this assumption for model 2?</p>
</div>
<div id="noise-processes" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Noise Processes<a href="exploratory-analysis-of-time-series-data.html#noise-processes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What if we re-arrange the model we fit above into a deterministic part and a random part:</p>
<p><span class="math display">\[\begin{align}
y_t - x_t \beta = w_t
\end{align}\]</span></p>
<p>What can we say about the right hand side? Since it is a random variable that is indexed by time, we can consider this our first and simplest time series model.</p>
<div id="white-noise" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> White noise<a href="exploratory-analysis-of-time-series-data.html#white-noise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let <span class="math inline">\(w_t\)</span> be a random variable indexed by time, <span class="math inline">\(t \in [1,T]\)</span>.</p>
<p>The following properties characterize white noise:</p>
<p><span class="math display">\[\begin{align}
E(w_t) &amp;= 0 \\
Var(w_t) &amp;= \sigma^2 \\
Cov(w_t, w_s) &amp;= 0 \text{  } \forall t,s
\end{align}\]</span></p>
<p>Note that Gaussian white noise is a special case where <span class="math inline">\(w_t \sim N(o, \sigma^2)\)</span>. White noise can come in different flavors. In the right hand plot below, <span class="math inline">\(w_t = 2e_t - 1\)</span>, where <span class="math inline">\(e_t \sim \text{Bernoulli(.5)}\)</span>. In the left plot, <span class="math inline">\(w_t \sim N(0,2)\)</span>.</p>
<p><img src="series_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="random-walk" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Random Walk<a href="exploratory-analysis-of-time-series-data.html#random-walk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let us consider another simple model to describe time series data,</p>
<p><span class="math inline">\(y_t = y_{t-1}+w_t\)</span>,</p>
<p>where <span class="math inline">\(w_t \sim N(0, \sigma^2)\)</span> and all elements of the error vector are mutually independent.</p>
<p>Let’s derive some important properties of this model:</p>
<ol style="list-style-type: decimal">
<li>What is the mean, <span class="math inline">\(E(y_t)\)</span>?</li>
<li>What is the variance, <span class="math inline">\(Var(y_t)\)</span>?</li>
</ol>
<p><img src="series_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="ar-process" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> AR Process<a href="exploratory-analysis-of-time-series-data.html#ar-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A slightly more general model is the autoregressive (AR) model, in which <span class="math inline">\(x_t\)</span> is a linear combination of its past <span class="math inline">\(p\)</span> values plus gaussian white noise, <span class="math inline">\(w_t\)</span>. That is,</p>
<p><span class="math display">\[\begin{align}
x_t = \sum_{i=1}^p \phi_i x_{t-i} + w_t.
\end{align}\]</span></p>
</div>
<div id="exercise" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Exercise<a href="exploratory-analysis-of-time-series-data.html#exercise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider the AR(1) process with a drift:</p>
<p><span class="math display">\[\begin{align}
x_t &amp;= a + \phi x_t + w_t
\end{align}\]</span></p>
<p>Write <span class="math inline">\(x_t\)</span> as a function of past white noise values and find <span class="math inline">\(E(x_t)\)</span> and <span class="math inline">\(Var(x_t)\)</span>.</p>
</div>
</div>
<div id="measures-of-dependence" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Measures of Dependence<a href="exploratory-analysis-of-time-series-data.html#measures-of-dependence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="autocovariance" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Autocovariance<a href="exploratory-analysis-of-time-series-data.html#autocovariance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In all but the simplest models, there is dependence between adjacent values <span class="math inline">\(x_s\)</span> and <span class="math inline">\(x_t\)</span>. This can be assessed using the notions of covariance and correlation. The autocovariance function is defined as the second moment product:</p>
<p><span class="math display">\[\begin{align}
\gamma(s,t) &amp;= \text{cov}(x_s, x_t) \\
&amp;= E((x_s - \mu_s) (x_t - \mu_t))
\end{align}\]</span></p>
<p>The autocovariance measures the linear dependence between two points on the same series observed at different times. Very smooth series exhibit autocovariance functions that stay large even when the <span class="math inline">\(t\)</span> and <span class="math inline">\(s\)</span> are far apart, whereas choppy series tend to have autocovariance functions that are nearly zero for large separations.</p>
</div>
<div id="autocorrelation" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Autocorrelation<a href="exploratory-analysis-of-time-series-data.html#autocorrelation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The autocorrelation function (ACF) is defined as,</p>
<p><span class="math display">\[\begin{align}
\rho(s,t) &amp;= \frac{\gamma(s,t)}{\sqrt{\gamma(s,s) \gamma(t,t)}}
\end{align}\]</span></p>
<p>The ACF measures the linear predictability of the series at time <span class="math inline">\(t\)</span>, say <span class="math inline">\(x_t\)</span> , using only the value <span class="math inline">\(x_s\)</span>.</p>
</div>
<div id="exercise-1" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Exercise<a href="exploratory-analysis-of-time-series-data.html#exercise-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Compute the autocorrelation of:</p>
<ol style="list-style-type: decimal">
<li>The white noise process</li>
<li>The random walk</li>
<li><span class="math inline">\(x_t = a + \phi x_{t-1} + w_t\)</span></li>
</ol>
</div>
</div>
<div id="stationarity" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Stationarity<a href="exploratory-analysis-of-time-series-data.html#stationarity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A (weakly) stationary time series <span class="math inline">\(x_t\)</span> is a process such that,</p>
<ol style="list-style-type: decimal">
<li>The mean is constant: <span class="math inline">\(E(X_t) = \mu\)</span>.</li>
<li>The autocovariance function, <span class="math inline">\(\gamma(s,t)\)</span> depends on <span class="math inline">\(s\)</span> and <span class="math inline">\(t\)</span> only through their difference, <span class="math inline">\(|s-t|\)</span>.</li>
</ol>
<p>Therefore, we can write the autocovariance function of a stationary time series as,</p>
<p><span class="math display">\[\begin{align}
\gamma(h) &amp;= \text{cov}(x_{t+h}, x_{t}) \\
&amp;= E((x_{t+h} - \mu) (x_{t} - \mu))
\end{align}\]</span></p>
<p>And, similarly, the autocorrelation function of a stationary time series can be written,</p>
<p><span class="math display">\[\begin{align}
\rho(h) &amp;= \frac{\gamma(t+h,t)}{\sqrt{\gamma(t+h,t+h) \gamma(t,t)}} \\
&amp;= \frac{\gamma(h)}{\gamma(0)}
\end{align}\]</span></p>
</div>
<div id="estimation" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Estimation<a href="exploratory-analysis-of-time-series-data.html#estimation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Although the theoretical mean, autocovariance, and autocorrelation functions are useful for describing the properties of certain hypothesized models, we also need to estimate these quantities using sampled data.</p>
<div id="mean" class="section level3 hasAnchor" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Mean<a href="exploratory-analysis-of-time-series-data.html#mean" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If a time series is stationary, the mean function is constant so that we can estimate it by the sample mean,</p>
<p><span class="math display">\[\begin{align}
\hat{\mu} = \frac{1}{T} \sum_{t=1}^T x_t
\end{align}\]</span></p>
<p><strong>What is the variance of the mean in a stationary time series context?</strong></p>
</div>
<div id="autocovariance-1" class="section level3 hasAnchor" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Autocovariance<a href="exploratory-analysis-of-time-series-data.html#autocovariance-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The sample autocovariance, <span class="math inline">\(\hat{\gamma}\)</span>, for a time series <span class="math inline">\(x\)</span> at lag <span class="math inline">\(k\)</span> is:</p>
<p><span class="math display">\[\begin{align}
\hat{\gamma}_k &amp;= \text{cov}(x_t, x_{t-k}) \\
&amp;=  \frac{1}{T} \sum_{t = k + 1}^{T} (x_t - \bar{x})(x_{t-k} - \bar{x})
\end{align}\]</span></p>
</div>
<div id="autocorrelation-1" class="section level3 hasAnchor" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> Autocorrelation<a href="exploratory-analysis-of-time-series-data.html#autocorrelation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The sample autocorrelation function for lag <span class="math inline">\(k\)</span>, <span class="math inline">\(\hat{\rho}_k\)</span>, is simply the lag <span class="math inline">\(k\)</span> autocovariance, <span class="math inline">\(\hat{\gamma_k}\)</span>, scaled by the sample variance.</p>
<p><span class="math display">\[\begin{align}
\hat{\rho}_k &amp;= \frac{ \hat{\gamma_k} }{\hat{\sigma}_{y_t} \hat{\sigma}_{y_{t-k}}} \\
&amp;= \frac{ \hat{\gamma_k} }{\hat{\gamma_0}}.
\end{align}\]</span></p>
</div>
</div>
<div id="lab-1" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Lab 1<a href="exploratory-analysis-of-time-series-data.html#lab-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Join the Kayak visits data (see below) to the conversions data from <a href="exploratory-analysis-of-time-series-data.html#time-series-eda">Time Series EDA</a>. Use the <code>inner_join</code> function with the argument, <code>by = c(“datestamp”, “country_code”, “marketing_channel”)</code> and then filter to only US observations. Make a plot of <code>user_visits</code> and <code>conversions</code> by day. Standardize them if it makes sense. Then, fit a linear regression model with <code>conversions</code> as the response variable and <code>user_visits</code> as the explanatory variable. What is the estimated line equation? Finally, make a plot of the residuals from this model. Do the residuals validate standard linear regression model assumptions?</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="exploratory-analysis-of-time-series-data.html#cb2-1" tabindex="-1"></a>visits <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/dbreynol/DS809/main/data/visits.csv&quot;</span>)</span>
<span id="cb2-2"><a href="exploratory-analysis-of-time-series-data.html#cb2-2" tabindex="-1"></a>visits<span class="sc">$</span>datestamp <span class="ot">=</span> <span class="fu">ymd</span>(visits<span class="sc">$</span>datestamp)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="exploratory-analysis-of-time-series-data.html#cb3-1" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">inner_join</span>(visits, conversions, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;datestamp&quot;</span>, <span class="st">&quot;country_code&quot;</span>, <span class="st">&quot;marketing_channel&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="exploratory-analysis-of-time-series-data.html#cb3-2" tabindex="-1"></a>  <span class="fu">filter</span>(country_code <span class="sc">==</span> <span class="st">&quot;us&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="exploratory-analysis-of-time-series-data.html#cb3-3" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="exploratory-analysis-of-time-series-data.html#cb3-4" tabindex="-1"></a>  <span class="fu">group_by</span>(datestamp) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="exploratory-analysis-of-time-series-data.html#cb3-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">visits =</span> <span class="fu">sum</span>(user_visits), <span class="at">conv =</span> <span class="fu">sum</span>(conversions))</span>
<span id="cb3-6"><a href="exploratory-analysis-of-time-series-data.html#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="exploratory-analysis-of-time-series-data.html#cb3-7" tabindex="-1"></a>conv_lm <span class="ot">=</span> <span class="fu">lm</span>(conv <span class="sc">~</span> visits, <span class="at">data =</span> df) <span class="co"># conversions = 2752.13 + .31 * visits</span></span>
<span id="cb3-8"><a href="exploratory-analysis-of-time-series-data.html#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="exploratory-analysis-of-time-series-data.html#cb3-9" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">std_visits =</span> (visits <span class="sc">-</span> <span class="fu">mean</span>(visits))<span class="sc">/</span><span class="fu">sd</span>(visits), <span class="at">std_conv =</span> (conv <span class="sc">-</span> <span class="fu">mean</span>(conv))<span class="sc">/</span><span class="fu">sd</span>(conv)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="exploratory-analysis-of-time-series-data.html#cb3-10" tabindex="-1"></a>  <span class="fu">select</span>(datestamp, std_visits, std_conv) <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="exploratory-analysis-of-time-series-data.html#cb3-11" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>datestamp) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="exploratory-analysis-of-time-series-data.html#cb3-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(datestamp, value)) <span class="sc">+</span> </span>
<span id="cb3-13"><a href="exploratory-analysis-of-time-series-data.html#cb3-13" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> name)) <span class="sc">+</span> </span>
<span id="cb3-14"><a href="exploratory-analysis-of-time-series-data.html#cb3-14" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb3-15"><a href="exploratory-analysis-of-time-series-data.html#cb3-15" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Standardized Visits and Conversions&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Smoothing a time series offers a way of visualizing the underlying trend of a process, which can often be obscured by seasonal as well as random fluctuations. One relatively simple method of smoothing a time series is by computing a moving average. For a time series <span class="math inline">\(y_t\)</span>, <span class="math inline">\(t = 1, \ldots, T\)</span>, a moving average of order <span class="math inline">\(m\)</span> can be written,
<span class="math display">\[\begin{align}
\hat{y_t} = \frac{1}{m} \sum_{j=-k}^{k} y_{t+j},
\end{align}\]</span>
where <span class="math inline">\(m=2k+1\)</span>. The concept behind this technique is that observations that are close in time are likely to be close in value. Compute a moving average of order <span class="math inline">\(m=13\)</span> for the <code>fma::elec</code> dataframe used in <a href="exploratory-analysis-of-time-series-data.html#classical-regression">Classical Regression</a>. Plot the smoothed series along with the raw data in a single plot.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="exploratory-analysis-of-time-series-data.html#cb4-1" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb4-2"><a href="exploratory-analysis-of-time-series-data.html#cb4-2" tabindex="-1"></a>elec_T <span class="ot">=</span> stats<span class="sc">::</span><span class="fu">filter</span>(fma<span class="sc">::</span>elec, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">13</span>, <span class="dv">13</span>), <span class="at">sides =</span> <span class="dv">2</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Time series data can exhibit a variety of patterns, and it is often helpful to decompose a time series into components, each representing an underlying pattern category. In this question, you will decompose a time series into three parts: a trend component (<span class="math inline">\(T\)</span>), a seasonality component (<span class="math inline">\(S\)</span>), and a random component (<span class="math inline">\(R\)</span>). That is, for each observation <span class="math inline">\(Y_t\)</span>, we want to break it down into three parts:</li>
</ol>
<p><span class="math display">\[Y_T = T_t + S_t + R_t\]</span>
You will again use the <code>fma::elec</code> dataframe and proceed in 3 steps:</p>
<ul>
<li><p><em>Step 1</em>: Compute the trend component using an order 13 moving average (good news: you did exactly this in the last question, so use the output from the prior question as the trend component, <span class="math inline">\(\hat{T}\)</span>).</p></li>
<li><p><em>Step 2</em>: Compute the detrended series: <span class="math inline">\(Y-\hat{T}\)</span></p></li>
<li><p><em>Step 3</em>: To estimate the seasonal component for each month, simply average the detrended values for each month. For example, the seasonal component for March is the average of all the detrended March values in the data. Then adjust the seasonal component values to ensure that they add to zero. The seasonal component is obtained by stringing together these monthly values, and then replicating the sequence for each year of data. This gives <span class="math inline">\(\hat{S}\)</span>.</p></li>
<li><p><em>Step 4</em>: The remainder component is calculated by subtracting the estimated seasonal and trend-cycle components. That is <span class="math inline">\(\hat{R} = Y - \hat{T} - \hat{S}\)</span>.</p></li>
</ul>
<p>Provide your code that is clearly commented for each step as well as a plot that shows each of the three component series in three separate plots (hint: use <code>par(mfrow = c(1,3))</code> to make three plots in a row).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="exploratory-analysis-of-time-series-data.html#cb5-1" tabindex="-1"></a>detrend <span class="ot">=</span> fma<span class="sc">::</span>elec <span class="sc">-</span> elec_T</span>
<span id="cb5-2"><a href="exploratory-analysis-of-time-series-data.html#cb5-2" tabindex="-1"></a>monthly_means <span class="ot">=</span> <span class="fu">tapply</span>(detrend, <span class="fu">cycle</span>(detrend), <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb5-3"><a href="exploratory-analysis-of-time-series-data.html#cb5-3" tabindex="-1"></a>elec_S <span class="ot">=</span> <span class="fu">ts</span> ( <span class="fu">rep</span>(monthly_means, <span class="at">length.out =</span> <span class="fu">length</span>(fma<span class="sc">::</span>elec)), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1956</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb5-4"><a href="exploratory-analysis-of-time-series-data.html#cb5-4" tabindex="-1"></a>elec_R <span class="ot">=</span> <span class="fu">ts</span> ( detrend <span class="sc">-</span> elec_S, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1956</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb5-5"><a href="exploratory-analysis-of-time-series-data.html#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="exploratory-analysis-of-time-series-data.html#cb5-6" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb5-7"><a href="exploratory-analysis-of-time-series-data.html#cb5-7" tabindex="-1"></a><span class="fu">plot</span>(elec_T, <span class="at">main =</span> <span class="st">&quot;Trend&quot;</span>)</span>
<span id="cb5-8"><a href="exploratory-analysis-of-time-series-data.html#cb5-8" tabindex="-1"></a><span class="fu">plot</span>(elec_S, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>,<span class="dv">1000</span>), <span class="at">main =</span> <span class="st">&quot;Seasonality&quot;</span>)</span>
<span id="cb5-9"><a href="exploratory-analysis-of-time-series-data.html#cb5-9" tabindex="-1"></a><span class="fu">plot</span>(elec_R, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>,<span class="dv">1000</span>), <span class="at">main =</span> <span class="st">&quot;Random&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="exploratory-analysis-of-time-series-data.html#cb6-1" tabindex="-1"></a><span class="co"># tseries::na.remove(ts) to look at acf plots for time series with na values</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>See chapter 1 of TSA (page 30) for a definition of cross correlation. This is a measure of the linear dependence of one time series on another. In other words, this is a multivariate version of the autocorrelation. Compute the cross correlation between GDP per capita and the Case Shiller Home Price Index (both from the FRED database), using the following data:</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="exploratory-analysis-of-time-series-data.html#cb7-1" tabindex="-1"></a>fred <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/dbreynol/DS809/main/data/fred_dat.csv&quot;</span>)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb7-2"><a href="exploratory-analysis-of-time-series-data.html#cb7-2" tabindex="-1"></a>fred<span class="sc">$</span>date <span class="ot">=</span> <span class="fu">ymd</span>(fred<span class="sc">$</span>date)</span></code></pre></div>
<p>Provide your code that computes the ccf for lag 0 and 1:10 in both <em>directions</em> (i.e., one where GDP/capita leads and the other in which the Case Shiller leads). Validate your calculations using the <code>ccf</code> function.</p>
<p>From the text, we aim to compute:
<span class="math display">\[\begin{align}
\hat{\gamma}_{xy}(h) = n^{-1} \sum_{t=1}^{n-h} (x_{t+h}-\bar{x})(y_t - \bar{y})
\end{align}\]</span></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="exploratory-analysis-of-time-series-data.html#cb8-1" tabindex="-1"></a>x <span class="ot">=</span> fred<span class="sc">$</span>gdp</span>
<span id="cb8-2"><a href="exploratory-analysis-of-time-series-data.html#cb8-2" tabindex="-1"></a>y <span class="ot">=</span> fred<span class="sc">$</span>shiller</span>
<span id="cb8-3"><a href="exploratory-analysis-of-time-series-data.html#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="exploratory-analysis-of-time-series-data.html#cb8-4" tabindex="-1"></a>xbar <span class="ot">=</span> <span class="fu">mean</span>(x)</span>
<span id="cb8-5"><a href="exploratory-analysis-of-time-series-data.html#cb8-5" tabindex="-1"></a>ybar <span class="ot">=</span> <span class="fu">mean</span>(y)</span>
<span id="cb8-6"><a href="exploratory-analysis-of-time-series-data.html#cb8-6" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">length</span>(x)</span>
<span id="cb8-7"><a href="exploratory-analysis-of-time-series-data.html#cb8-7" tabindex="-1"></a>den <span class="ot">=</span> <span class="fu">sqrt</span>( <span class="fu">sum</span>( (x <span class="sc">-</span> xbar) <span class="sc">^</span> <span class="dv">2</span> ) <span class="sc">*</span> <span class="fu">sum</span>( (y <span class="sc">-</span> ybar) <span class="sc">^</span><span class="dv">2</span> ))</span>
<span id="cb8-8"><a href="exploratory-analysis-of-time-series-data.html#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="exploratory-analysis-of-time-series-data.html#cb8-9" tabindex="-1"></a>h <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb8-10"><a href="exploratory-analysis-of-time-series-data.html#cb8-10" tabindex="-1"></a><span class="co"># compute ccf for a given value of h</span></span>
<span id="cb8-11"><a href="exploratory-analysis-of-time-series-data.html#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="exploratory-analysis-of-time-series-data.html#cb8-12" tabindex="-1"></a>my_ccf <span class="ot">=</span> <span class="fu">sapply</span>( <span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span> , <span class="cf">function</span>(hi) {</span>
<span id="cb8-13"><a href="exploratory-analysis-of-time-series-data.html#cb8-13" tabindex="-1"></a>  <span class="cf">if</span>(hi <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-14"><a href="exploratory-analysis-of-time-series-data.html#cb8-14" tabindex="-1"></a>    x <span class="ot">=</span> <span class="fu">lag</span>(x, <span class="fu">abs</span>(hi))</span>
<span id="cb8-15"><a href="exploratory-analysis-of-time-series-data.html#cb8-15" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(hi <span class="sc">&gt;</span> <span class="dv">0</span>) { </span>
<span id="cb8-16"><a href="exploratory-analysis-of-time-series-data.html#cb8-16" tabindex="-1"></a>    y <span class="ot">=</span> <span class="fu">lag</span>(y, hi) }</span>
<span id="cb8-17"><a href="exploratory-analysis-of-time-series-data.html#cb8-17" tabindex="-1"></a>  <span class="fu">sum</span>( (x <span class="sc">-</span> xbar) <span class="sc">*</span> (y <span class="sc">-</span> ybar) , <span class="at">na.rm =</span> T ) <span class="sc">/</span> den</span>
<span id="cb8-18"><a href="exploratory-analysis-of-time-series-data.html#cb8-18" tabindex="-1"></a>  })</span>
<span id="cb8-19"><a href="exploratory-analysis-of-time-series-data.html#cb8-19" tabindex="-1"></a>  </span>
<span id="cb8-20"><a href="exploratory-analysis-of-time-series-data.html#cb8-20" tabindex="-1"></a><span class="fu">names</span>(my_ccf) <span class="ot">=</span> <span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb8-21"><a href="exploratory-analysis-of-time-series-data.html#cb8-21" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(my_ccf, <span class="dv">3</span>))</span></code></pre></div>
<pre><code>##   -10    -9    -8    -7    -6    -5    -4    -3    -2    -1     0     1     2 
## 0.460 0.502 0.554 0.617 0.668 0.717 0.771 0.821 0.864 0.906 0.951 0.884 0.817 
##     3     4     5     6     7     8     9    10 
## 0.755 0.687 0.609 0.528 0.457 0.393 0.333 0.279</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="exploratory-analysis-of-time-series-data.html#cb10-1" tabindex="-1"></a>(<span class="fu">ccf</span>(x,y, <span class="at">type =</span> <span class="st">&quot;correlation&quot;</span>, <span class="at">lag.max =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre><code>## 
## Autocorrelations of series &#39;X&#39;, by lag
## 
##   -10    -9    -8    -7    -6    -5    -4    -3    -2    -1     0     1     2 
## 0.460 0.502 0.554 0.617 0.668 0.717 0.771 0.821 0.864 0.906 0.951 0.884 0.817 
##     3     4     5     6     7     8     9    10 
## 0.755 0.687 0.609 0.528 0.457 0.393 0.333 0.279</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Write a function in R that takes two arguments: a time series (<span class="math inline">\(y\)</span>) vector and a vector (<span class="math inline">\(k\)</span>) specifying a set of lags. The output for this function is the autocorrelation of <span class="math inline">\(y\)</span> for each lag in <span class="math inline">\(k\)</span>, using the formula in <a href="exploratory-analysis-of-time-series-data.html#autocorrelation">Autocorrelation</a>. Compare the output of your function to the output from <code>(acf(y))</code>.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="exploratory-analysis-of-time-series-data.html#cb12-1" tabindex="-1"></a><span class="co"># simulated data to test function</span></span>
<span id="cb12-2"><a href="exploratory-analysis-of-time-series-data.html#cb12-2" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">arima.sim</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(.<span class="dv">1</span>,.<span class="dv">2</span>)))</span>
<span id="cb12-3"><a href="exploratory-analysis-of-time-series-data.html#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="exploratory-analysis-of-time-series-data.html#cb12-4" tabindex="-1"></a>acf_fun <span class="ot">=</span> <span class="cf">function</span>(y, k) {</span>
<span id="cb12-5"><a href="exploratory-analysis-of-time-series-data.html#cb12-5" tabindex="-1"></a>  </span>
<span id="cb12-6"><a href="exploratory-analysis-of-time-series-data.html#cb12-6" tabindex="-1"></a>  mean_y <span class="ot">=</span> <span class="fu">mean</span>(y)</span>
<span id="cb12-7"><a href="exploratory-analysis-of-time-series-data.html#cb12-7" tabindex="-1"></a>  gamma_0 <span class="ot">=</span> <span class="fu">sum</span>((y <span class="sc">-</span> mean_y) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb12-8"><a href="exploratory-analysis-of-time-series-data.html#cb12-8" tabindex="-1"></a>  </span>
<span id="cb12-9"><a href="exploratory-analysis-of-time-series-data.html#cb12-9" tabindex="-1"></a>  <span class="co"># compute autocovariance for each lag in k</span></span>
<span id="cb12-10"><a href="exploratory-analysis-of-time-series-data.html#cb12-10" tabindex="-1"></a>  <span class="fu">sapply</span>(k, <span class="cf">function</span>(ki) {</span>
<span id="cb12-11"><a href="exploratory-analysis-of-time-series-data.html#cb12-11" tabindex="-1"></a>    v1 <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">window</span>(y, <span class="at">end =</span> <span class="fu">length</span>(y) <span class="sc">-</span> ki))  <span class="co"># ends &#39;early&#39;</span></span>
<span id="cb12-12"><a href="exploratory-analysis-of-time-series-data.html#cb12-12" tabindex="-1"></a>    v2 <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">window</span>(y, <span class="at">start =</span> ki <span class="sc">+</span> <span class="dv">1</span>))       <span class="co"># starts &#39;late&#39;</span></span>
<span id="cb12-13"><a href="exploratory-analysis-of-time-series-data.html#cb12-13" tabindex="-1"></a>    </span>
<span id="cb12-14"><a href="exploratory-analysis-of-time-series-data.html#cb12-14" tabindex="-1"></a>    gamma_k <span class="ot">=</span> <span class="fu">sum</span>((v1 <span class="sc">-</span> mean_y) <span class="sc">*</span> (v2 <span class="sc">-</span> mean_y))</span>
<span id="cb12-15"><a href="exploratory-analysis-of-time-series-data.html#cb12-15" tabindex="-1"></a>    </span>
<span id="cb12-16"><a href="exploratory-analysis-of-time-series-data.html#cb12-16" tabindex="-1"></a>    <span class="fu">return</span>(gamma_k <span class="sc">/</span> gamma_0)</span>
<span id="cb12-17"><a href="exploratory-analysis-of-time-series-data.html#cb12-17" tabindex="-1"></a>  })</span>
<span id="cb12-18"><a href="exploratory-analysis-of-time-series-data.html#cb12-18" tabindex="-1"></a>}</span>
<span id="cb12-19"><a href="exploratory-analysis-of-time-series-data.html#cb12-19" tabindex="-1"></a></span>
<span id="cb12-20"><a href="exploratory-analysis-of-time-series-data.html#cb12-20" tabindex="-1"></a><span class="fu">print</span> ( <span class="fu">acf_fun</span>(y,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)) )</span></code></pre></div>
<pre><code>## [1] -0.02955049  0.07644815 -0.10432208  0.22030633 -0.27448442</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="exploratory-analysis-of-time-series-data.html#cb14-1" tabindex="-1"></a><span class="fu">print</span> ( (<span class="fu">acf</span>(y, <span class="at">plot =</span> F))<span class="sc">$</span>acf[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] )</span></code></pre></div>
<pre><code>## [1] -0.02955049  0.07644815 -0.10432208  0.22030633 -0.27448442</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Simulate data from the following model: <span class="math inline">\(x_t = a + \phi x_{t-1} + w_t\)</span>, in which <span class="math inline">\(w_t \sim N(0,\sigma^2)\)</span>. You can choose the value for parameters: <span class="math inline">\(\phi, \sigma^2, a\)</span>. Report which values you chose and make a plot of the theoretical versus observed autocorrelation function for a simulation with length <span class="math inline">\(T=100\)</span> and a simulation with length <span class="math inline">\(T=10,000\)</span>.</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="arma.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dbreynol/DS809/edit/master/set1.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
