<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Set 2 Exploratory Analysis of Time Series Data | DS809</title>
  <meta name="description" content="Course materials for DS809, Spring 2024." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Set 2 Exploratory Analysis of Time Series Data | DS809" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Course materials for DS809, Spring 2024." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Set 2 Exploratory Analysis of Time Series Data | DS809" />
  
  <meta name="twitter:description" content="Course materials for DS809, Spring 2024." />
  

<meta name="author" content="David Reynolds" />


<meta name="date" content="2024-12-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">UNH DS809</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Course Info</a></li>
<li class="chapter" data-level="2" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html"><i class="fa fa-check"></i><b>2</b> Exploratory Analysis of Time Series Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#time-series-data"><i class="fa fa-check"></i><b>2.1</b> Time Series Data</a></li>
<li class="chapter" data-level="2.2" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#time-series-eda"><i class="fa fa-check"></i><b>2.2</b> Time Series EDA</a></li>
<li class="chapter" data-level="2.3" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#classical-regression"><i class="fa fa-check"></i><b>2.3</b> Classical Regression</a></li>
<li class="chapter" data-level="2.4" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#noise-processes"><i class="fa fa-check"></i><b>2.4</b> Noise Processes</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#white-noise"><i class="fa fa-check"></i><b>2.4.1</b> White noise</a></li>
<li class="chapter" data-level="2.4.2" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#random-walk"><i class="fa fa-check"></i><b>2.4.2</b> Random Walk</a></li>
<li class="chapter" data-level="2.4.3" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#ar-process"><i class="fa fa-check"></i><b>2.4.3</b> AR Process</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#autocorrelation"><i class="fa fa-check"></i><b>2.5</b> Autocorrelation</a></li>
<li class="chapter" data-level="2.6" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#stationarity"><i class="fa fa-check"></i><b>2.6</b> Stationarity</a></li>
<li class="chapter" data-level="2.7" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#multiple-time-series"><i class="fa fa-check"></i><b>2.7</b> Multiple Time Series</a></li>
<li class="chapter" data-level="2.8" data-path="exploratory-analysis-of-time-series-data.html"><a href="exploratory-analysis-of-time-series-data.html#lab-1"><i class="fa fa-check"></i><b>2.8</b> Lab 1</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DS809</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory-analysis-of-time-series-data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Set 2</span> Exploratory Analysis of Time Series Data<a href="exploratory-analysis-of-time-series-data.html#exploratory-analysis-of-time-series-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="time-series-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Time Series Data<a href="exploratory-analysis-of-time-series-data.html#time-series-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>A time series is an ordered sequence of observations, where the ordering is through time.</p></li>
<li><p>Time series data creates unique problems for statistical modeling and inference.</p>
<ul>
<li>Traditional inference assumes that observations (data) are independent and identically distributed. Adjacent data points in time series data are not necessarily independent (uncorrelated).</li>
<li>Most time series models aim to exploit such dependence. For instance, yesterday’s demand of a product may tell us something about today’s
demand of a product.</li>
</ul></li>
<li><p>There are several different ways to represent time series data in R.</p></li>
<li><p>We will use the <code>tidyverse</code> family of packages extensively in this class. This package includes the <code>lubridate</code> package, which includes functions to work with date-times.</p></li>
<li><p>Two of the most common ways to represent time series data are using data frames in which one of the variables is a time object (such as POSIXct or Date) or using a time series object.</p></li>
</ul>
</div>
<div id="time-series-eda" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Time Series EDA<a href="exploratory-analysis-of-time-series-data.html#time-series-eda" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first thing to do in any data analysis is exploratory data analysis (EDA). Graphs enable many features of the data to be visualized, including patterns, unusual observations, changes over time, and relationships between variables. The features that are seen in plots of the data can then be incorporated into statistical models.</p>
<p>R has several systems for making graphs. We will primarily use ggplot2, which is among the set of tidyverse packages and is one of the most versatile systems for plotting. We will use a data set from Kayak to motivate our analysis.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="exploratory-analysis-of-time-series-data.html#cb1-1" tabindex="-1"></a>conversions <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/dbreynol/DS809/main/data/conversions.csv&quot;</span>)</span>
<span id="cb1-2"><a href="exploratory-analysis-of-time-series-data.html#cb1-2" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(conversions))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">datestamp</th>
<th align="left">country_code</th>
<th align="left">marketing_channel</th>
<th align="right">conversions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2014-11-01</td>
<td align="left">be</td>
<td align="left">Display Ads</td>
<td align="right">1174</td>
</tr>
<tr class="even">
<td align="left">2014-11-01</td>
<td align="left">be</td>
<td align="left">KAYAK Deals Email</td>
<td align="right">57</td>
</tr>
<tr class="odd">
<td align="left">2014-11-01</td>
<td align="left">be</td>
<td align="left">Search Engine Ads</td>
<td align="right">1122</td>
</tr>
<tr class="even">
<td align="left">2014-11-01</td>
<td align="left">be</td>
<td align="left">Search Engine Results</td>
<td align="right">976</td>
</tr>
<tr class="odd">
<td align="left">2014-11-01</td>
<td align="left">fi</td>
<td align="left">Display Ads</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">2014-11-01</td>
<td align="left">fi</td>
<td align="left">Search Engine Results</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>This dataset contains information on the total number of daily conversions by country and marketing channel. Let us focus our analysis on the US and fist visualize the number of conversions by day.</p>
<p><img src="series_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>This plot contains a lot of useful information. To gain insight into how conversions depend on marketing channel, we can use facets. Facets are subplots that display a time series for each marketing channel.</p>
<p><img src="series_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Display ads and search engine ads are the dominant marketing channels. Both have a regular pattern that is likely a function of the day of week, with a higher number of conversions during weekdays as compared with weekends. We can explore this feature by aggregating over each weekday and visualizing how the distribution of conversions changes by day.</p>
<p><img src="series_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Clearly, there are significant changes in the mean level of conversions across the week. This is a form of seasonality. It may be useful to see what the data look like when this weekday effect is removed. To do so, we could visualize the residuals from the following linear regression model:</p>
<p><span class="math display">\[\begin{align}
\hat{\text{conversions}} = \hat{\beta}_0 + \sum_{j=2}^7 \bigg( \hat{\beta}_j \times 1(\text{weekday = j}) \bigg),
\end{align}\]</span></p>
<p>where <span class="math inline">\(j\)</span> indexes the day of week. The residuals from this model consist of each observation minus the mean for that particular weekday.</p>
<p><img src="series_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>This allows us to more clearly see the trend across the date range, removing the effect of the weekly pattern.</p>
</div>
<div id="classical-regression" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Classical Regression<a href="exploratory-analysis-of-time-series-data.html#classical-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Given that regression is already in your tool kit, we will use it to model a time series. Let us assume that we have some output or dependent time series, say, <span class="math inline">\(x_t\)</span> , for <span class="math inline">\(t = 1, \ldots,n\)</span>, that is being influenced by a collection of possible inputs, say, <span class="math inline">\(z_{t1}, z_{t2}, \ldots, z_{tq}\)</span>, where we regard the inputs as fixed and known.</p>
<p>We will look at monthly Australian electricity production (the <code>fpp2::elec</code> dataframe). The data is shown below.</p>
<p><img src="series_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Let us fit two models to this data, one where we use time as the independent variable. This estimates a linear trend. In the other, we will try to capture some of the obvious seasonality in the data.</p>
<p><span class="math display">\[\begin{align}
y_t &amp;= \beta_0 + \beta_1 t + w_t \\
y_t &amp;= \beta_0 + \beta_1 t + \beta_2 \times ({2\pi \cos(t)}) + w_t
\end{align}\]</span></p>
<p>The fits from these two models are shown below.</p>
<p><img src="series_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Clearly, model 2 offers a superior fit as compared with model 1. In fact, this model explains about 95% of the variation in electricity production. To check the validity of the model, let us examine the residuals across the range of time, <span class="math inline">\(t\)</span>.</p>
<p><img src="series_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>One of the assumptions of the linear regression model is that the errors are independent and identically distributed. That is, for the model,</p>
<p><span class="math display">\[\begin{align}
y = X \beta + \epsilon,
\end{align}\]</span></p>
<p>The error vector, <span class="math inline">\(\epsilon \sim N(0, \sigma^2)\)</span>. This implies that there is no correlation structure to the residuals. One way to check that this is true is to check for the absence of correlation in the observed residuals.</p>
</div>
<div id="noise-processes" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Noise Processes<a href="exploratory-analysis-of-time-series-data.html#noise-processes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Thus far, we have explored time series data to better understand their properties. These exploration methods can also be used to generate forecasts for future values. However, they are not able to quantify the uncertainty inherent in those forecasts, nor do they model the dependency structure inherent in the time series data. We will begin with a very simple model that does both of these things.</p>
<div id="white-noise" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> White noise<a href="exploratory-analysis-of-time-series-data.html#white-noise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now let us define a new time series, <span class="math inline">\(z_t = y_t - y_{t-1}\)</span>.</p>
<p>Define the same properties as 1-5 above. These two simple models are important in finance. If a time series follows a random walk, then its first difference is white noise. Let’s see if this is the case with GOOG.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="exploratory-analysis-of-time-series-data.html#cb2-1" tabindex="-1"></a>goog <span class="ot">=</span> <span class="fu">getSymbols</span>(<span class="st">&#39;GOOG&#39;</span>, <span class="at">from=</span><span class="st">&#39;2020-12-22&#39;</span>, <span class="at">to=</span><span class="st">&#39;2023-12-22&#39;</span>,<span class="at">auto.assign =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-2"><a href="exploratory-analysis-of-time-series-data.html#cb2-2" tabindex="-1"></a>googdf <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">ymd</span>(<span class="fu">index</span>(goog)), goog<span class="sc">$</span>GOOG.Close)</span>
<span id="cb2-3"><a href="exploratory-analysis-of-time-series-data.html#cb2-3" tabindex="-1"></a><span class="fu">names</span>(googdf) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;price&quot;</span>)</span>
<span id="cb2-4"><a href="exploratory-analysis-of-time-series-data.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="exploratory-analysis-of-time-series-data.html#cb2-5" tabindex="-1"></a><span class="fu">ggplot</span>(googdf, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> price)) <span class="sc">+</span> </span>
<span id="cb2-6"><a href="exploratory-analysis-of-time-series-data.html#cb2-6" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb2-7"><a href="exploratory-analysis-of-time-series-data.html#cb2-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb2-8"><a href="exploratory-analysis-of-time-series-data.html#cb2-8" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;GOOG Closing Price&quot;</span>)</span></code></pre></div>
</div>
<div id="random-walk" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Random Walk<a href="exploratory-analysis-of-time-series-data.html#random-walk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let us consider a simple model to describe time series data,</p>
<p><span class="math inline">\(y_t = y_{t-1}+e_t\)</span>,</p>
<p>where <span class="math inline">\(e_t \sim N(0, \sigma^2)\)</span> and all elements of the error vector are mutually independent.</p>
<p>Let’s derive some important properties of this model:</p>
<ol style="list-style-type: decimal">
<li>What is the mean, <span class="math inline">\(E(y_t)\)</span>?</li>
<li>What is the variance, <span class="math inline">\(Var(y_t)\)</span>?</li>
<li>What is the covariance between successive observations, <span class="math inline">\(\text{cov}(y_t, y_{t-1})\)</span>?</li>
<li>What is the correlation between successive observations, <span class="math inline">\(\text{cor}(y_t, y_{t-1})\)</span>?</li>
<li>Which properties depend on time?</li>
</ol>
</div>
<div id="ar-process" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> AR Process<a href="exploratory-analysis-of-time-series-data.html#ar-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="autocorrelation" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Autocorrelation<a href="exploratory-analysis-of-time-series-data.html#autocorrelation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>compute autocorrelation of ar process</p>
<p>To review this concept, we’ll start with a definition for covariance. For two vectors of data, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, the covariance between the two is,</p>
<p><span class="math display">\[\begin{align}
\text{cov}(x,y) &amp;= \frac{ \sum_i (x_i - \bar{x})(y_i - \bar{y})}{n-1}
\end{align}\]</span></p>
<p>Correlation is a dimensionless measure of the linear association between two variables. It is defined as the covariance scaled by the standard deviations. That is,</p>
<p><span class="math display">\[\begin{align}
\text{cor}(x,y) &amp;= \frac{\text{cov}(x,y)}{\sigma_x \sigma_y} \\
                &amp;= \frac{ \sum_i (x_i - \bar{x})(y_i - \bar{y})}{ \sqrt{ \sum_i (x_i - \bar{x})^2 \sum_i (y_i - \bar{y})^2 }}
\end{align}\]</span></p>
<p>Let’s compute this quantity on some simulated data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="exploratory-analysis-of-time-series-data.html#cb3-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb3-2"><a href="exploratory-analysis-of-time-series-data.html#cb3-2" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb3-3"><a href="exploratory-analysis-of-time-series-data.html#cb3-3" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb3-4"><a href="exploratory-analysis-of-time-series-data.html#cb3-4" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb3-5"><a href="exploratory-analysis-of-time-series-data.html#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="exploratory-analysis-of-time-series-data.html#cb3-6" tabindex="-1"></a><span class="fu">sum</span>( (x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">*</span> (y <span class="sc">-</span> <span class="fu">mean</span>(y))) <span class="sc">/</span> ( (n<span class="dv">-1</span>) <span class="sc">*</span> <span class="fu">sd</span>(x) <span class="sc">*</span> <span class="fu">sd</span>(y) )</span>
<span id="cb3-7"><a href="exploratory-analysis-of-time-series-data.html#cb3-7" tabindex="-1"></a><span class="fu">cor</span>(x, y)</span></code></pre></div>
<p>For time series data, there is a closely related concept called autocorrelation. Given a time series, <span class="math inline">\(y_t\)</span>, where <span class="math inline">\(t=1,\ldots,T\)</span>, autocorrelation is the correlation between <span class="math inline">\(y_t\)</span> and its lagged value, <span class="math inline">\(y_{t-k}\)</span>. That is, autocorrelation is the correlation of a time series with a delayed copy of itself, as a function of delay. Just as correlation is a function of covariance, autocorrelation is a function of autocovariance. The (sample) autocovariance, <span class="math inline">\(\hat{\gamma}\)</span> for a time series <span class="math inline">\(y\)</span> at lag <span class="math inline">\(k\)</span> is:</p>
<p><span class="math display">\[\begin{align}
\hat{\gamma}_k &amp;= \text{cov}(y_t, y_{t-k}) \\
&amp;=  \frac{1}{T} \sum_{t = k + 1}^{T} (y_t - \bar{y})(y_{t-k} - \bar{y})
\end{align}\]</span></p>
<p>The (sample) autocorrelation function for lag <span class="math inline">\(k\)</span>, <span class="math inline">\(\hat{\rho}_k\)</span>, is simply the lag <span class="math inline">\(k\)</span> autocovariance, <span class="math inline">\(\hat{\gamma_k}\)</span> , scaled by the standard deviations.</p>
<p><span class="math display">\[\begin{align}
\hat{\rho}_k &amp;= \frac{ \hat{\gamma_k} }{\hat{\sigma}_{y_t} \hat{\sigma}_{y_{t-k}}} \\
&amp;= \frac{ \hat{\gamma_k} }{\hat{\gamma_0}}.
\end{align}\]</span></p>
<p>The second line follows from the linear regression assumption of constant variance. Here is a simple example of computing the lag 1 autocorrelation.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="exploratory-analysis-of-time-series-data.html#cb4-1" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb4-2"><a href="exploratory-analysis-of-time-series-data.html#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="exploratory-analysis-of-time-series-data.html#cb4-3" tabindex="-1"></a>a1 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb4-4"><a href="exploratory-analysis-of-time-series-data.html#cb4-4" tabindex="-1"></a>a2 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb4-5"><a href="exploratory-analysis-of-time-series-data.html#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="exploratory-analysis-of-time-series-data.html#cb4-6" tabindex="-1"></a><span class="co"># lag 1 autocorrelation</span></span>
<span id="cb4-7"><a href="exploratory-analysis-of-time-series-data.html#cb4-7" tabindex="-1"></a><span class="fu">sum</span>( (a1 <span class="sc">-</span> <span class="fu">mean</span>(a)) <span class="sc">*</span> (a2 <span class="sc">-</span> <span class="fu">mean</span>(a))) <span class="sc">/</span> (<span class="fu">sum</span>( (a <span class="sc">-</span> <span class="fu">mean</span>(a))<span class="sc">^</span><span class="dv">2</span> ) )  <span class="co"># by hand</span></span>
<span id="cb4-8"><a href="exploratory-analysis-of-time-series-data.html#cb4-8" tabindex="-1"></a>(<span class="fu">acf</span>(a))</span></code></pre></div>
</div>
<div id="stationarity" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Stationarity<a href="exploratory-analysis-of-time-series-data.html#stationarity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Stationarity is a convenient assumption that allows us to describe the statistical properties of a time series. A time series is said to be stationary if there is:</p>
<ol style="list-style-type: decimal">
<li>Constant mean. <span class="math inline">\(E(X_t) = \mu\)</span>.</li>
<li>Constant variance. <span class="math inline">\(Var(X_t) = \sigma^2\)</span>.</li>
<li>Constant Autocorrelation. <span class="math inline">\(Cor(X_t, X_{t-h}) = \rho_h\)</span>.</li>
</ol>
<p>compute mean/ variance under stationarity</p>
</div>
<div id="multiple-time-series" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Multiple Time Series<a href="exploratory-analysis-of-time-series-data.html#multiple-time-series" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Often we will want to develop insight into the relationship between several variables. To illustrate, we will use quarterly data on GDP per capita and the Case Shiller Home Price Index (both from the FRED database).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="exploratory-analysis-of-time-series-data.html#cb5-1" tabindex="-1"></a>fred <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/dbreynol/DS809/main/data/fred_dat.csv&quot;</span>)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb5-2"><a href="exploratory-analysis-of-time-series-data.html#cb5-2" tabindex="-1"></a>fred<span class="sc">$</span>date <span class="ot">=</span> <span class="fu">ymd</span>(fred<span class="sc">$</span>date)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>It looks like these two time series track pretty closely to one another. We could fit a linear regression to this data in order to estimate the expected change in the Case Shiller Index for a unit ($1) change in GDP/ capital</p>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-556.2290146</td>
<td align="right">33.8244315</td>
<td align="right">-16.44459</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">0.0126208</td>
<td align="right">0.0005663</td>
<td align="right">22.28669</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Further, we could also examine the residuals to gain insight into what is missing from this model.</p>
<p><img src="series_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The model severely underestimates the house index starting during the pandemic. There is a clear pattern to these residuals. Is this a problem?</p>
</div>
<div id="lab-1" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Lab 1<a href="exploratory-analysis-of-time-series-data.html#lab-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>cross correlation/ decomposition/</p>
<ol start="2" style="list-style-type: decimal">
<li>We can further hone in on the underlying trend of the residuals at the end of <a href="exploratory-analysis-of-time-series-data.html#time-series-eda">Time Series EDA</a> by computing and plotting a moving average. For a time series <span class="math inline">\(y_t\)</span>, <span class="math inline">\(t = 1, \ldots, T\)</span>, a moving average of order <span class="math inline">\(m\)</span> can be written,
<span class="math display">\[\begin{align}
\hat{y_t} = \frac{1}{m} \sum_{j=-k}^{k} y_{t+j},
\end{align}\]</span>
where <span class="math inline">\(m=2k+1\)</span>. The concept behind this technique is that observations that are close in time are likely to be close in value. Compute a moving average of order <span class="math inline">\(m=7\)</span> for the residual time series and plot it along with the residuals in a single plot.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="exploratory-analysis-of-time-series-data.html#cb6-1" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">length</span>(mod_df<span class="sc">$</span>resids)</span>
<span id="cb6-2"><a href="exploratory-analysis-of-time-series-data.html#cb6-2" tabindex="-1"></a>ma_resids <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> n) <span class="co"># initialize residuals vector</span></span>
<span id="cb6-3"><a href="exploratory-analysis-of-time-series-data.html#cb6-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">4</span><span class="sc">:</span>(n<span class="dv">-3</span>)) { </span>
<span id="cb6-4"><a href="exploratory-analysis-of-time-series-data.html#cb6-4" tabindex="-1"></a>  ma_resids[i] <span class="ot">=</span> <span class="fu">mean</span>(mod_df<span class="sc">$</span>resids[(i<span class="dv">-3</span>)<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">3</span>)])</span>
<span id="cb6-5"><a href="exploratory-analysis-of-time-series-data.html#cb6-5" tabindex="-1"></a>}</span>
<span id="cb6-6"><a href="exploratory-analysis-of-time-series-data.html#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="exploratory-analysis-of-time-series-data.html#cb6-7" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">date =</span> mod_df<span class="sc">$</span>datestamp, <span class="at">resids =</span> mod_df<span class="sc">$</span>resids, <span class="at">ma =</span> ma_resids) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="exploratory-analysis-of-time-series-data.html#cb6-8" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="exploratory-analysis-of-time-series-data.html#cb6-9" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="exploratory-analysis-of-time-series-data.html#cb6-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, value)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> name)) <span class="sc">+</span> </span>
<span id="cb6-11"><a href="exploratory-analysis-of-time-series-data.html#cb6-11" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb6-12"><a href="exploratory-analysis-of-time-series-data.html#cb6-12" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Plot of Residuals and their order 7 moving average&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Join the Kayak visits data (see below) to the conversions data from <a href="exploratory-analysis-of-time-series-data.html#time-series-eda">Time Series EDA</a>. Use the <code>inner_join</code> function with the argument, <code>by = c(“datestamp”, “country_code”, “marketing_channel”)</code> and then filter to only US observations. Make a plot of <code>user_visits</code> and <code>conversions</code> by day. Standardize them if it makes sense. Then, fit a linear regression model with <code>conversions</code> as the response variable and <code>user_visits</code> as the explanatory variable. What is the estimated line equation? Finally, make a plot of the residuals from this model.</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="exploratory-analysis-of-time-series-data.html#cb7-1" tabindex="-1"></a>visits <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/dbreynol/DS809/main/data/visits.csv&quot;</span>)</span>
<span id="cb7-2"><a href="exploratory-analysis-of-time-series-data.html#cb7-2" tabindex="-1"></a>visits<span class="sc">$</span>datestamp <span class="ot">=</span> <span class="fu">ymd</span>(visits<span class="sc">$</span>datestamp)</span>
<span id="cb7-3"><a href="exploratory-analysis-of-time-series-data.html#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="exploratory-analysis-of-time-series-data.html#cb7-4" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">inner_join</span>(visits, conversions, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;datestamp&quot;</span>, <span class="st">&quot;country_code&quot;</span>, <span class="st">&quot;marketing_channel&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="exploratory-analysis-of-time-series-data.html#cb7-5" tabindex="-1"></a>  <span class="fu">filter</span>(country_code <span class="sc">==</span> <span class="st">&quot;us&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="exploratory-analysis-of-time-series-data.html#cb7-6" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="exploratory-analysis-of-time-series-data.html#cb7-7" tabindex="-1"></a>  <span class="fu">group_by</span>(datestamp) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="exploratory-analysis-of-time-series-data.html#cb7-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">visits =</span> <span class="fu">sum</span>(user_visits), <span class="at">conv =</span> <span class="fu">sum</span>(conversions))</span>
<span id="cb7-9"><a href="exploratory-analysis-of-time-series-data.html#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="exploratory-analysis-of-time-series-data.html#cb7-10" tabindex="-1"></a>conv_lm <span class="ot">=</span> <span class="fu">lm</span>(conv <span class="sc">~</span> visits, <span class="at">data =</span> df) <span class="co"># conversions = 2752.13 + .31 * visits</span></span>
<span id="cb7-11"><a href="exploratory-analysis-of-time-series-data.html#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="exploratory-analysis-of-time-series-data.html#cb7-12" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">std_visits =</span> (visits <span class="sc">-</span> <span class="fu">mean</span>(visits))<span class="sc">/</span><span class="fu">sd</span>(visits), <span class="at">std_conv =</span> (conv <span class="sc">-</span> <span class="fu">mean</span>(conv))<span class="sc">/</span><span class="fu">sd</span>(conv)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="exploratory-analysis-of-time-series-data.html#cb7-13" tabindex="-1"></a>  <span class="fu">select</span>(datestamp, std_visits, std_conv) <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="exploratory-analysis-of-time-series-data.html#cb7-14" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>datestamp) <span class="sc">%&gt;%</span> </span>
<span id="cb7-15"><a href="exploratory-analysis-of-time-series-data.html#cb7-15" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(datestamp, value)) <span class="sc">+</span> </span>
<span id="cb7-16"><a href="exploratory-analysis-of-time-series-data.html#cb7-16" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> name)) <span class="sc">+</span> </span>
<span id="cb7-17"><a href="exploratory-analysis-of-time-series-data.html#cb7-17" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb7-18"><a href="exploratory-analysis-of-time-series-data.html#cb7-18" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Standardized Visits and Conversions&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Wrtie a function in R that takes two arguments: a time series (<span class="math inline">\(y\)</span>) formatted as a vector and an integer (<span class="math inline">\(k\)</span>) specifying a lag. The output for this function is the lag <span class="math inline">\(k\)</span> autocorrelation for <span class="math inline">\(y\)</span>, using the formula in <a href="exploratory-analysis-of-time-series-data.html#autocorrelation">Autocorrelation</a>. Compare the output of your function to the output from <code>(acf(y))</code>. An extra challenge is to allow <span class="math inline">\(k\)</span> to be a vector of lags, in which case your function should return a vector of autocorrelation values.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="exploratory-analysis-of-time-series-data.html#cb8-1" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">arima.sim</span>(<span class="at">n =</span> <span class="fl">1e5</span>, <span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(.<span class="dv">1</span>,.<span class="dv">2</span>)))</span>
<span id="cb8-2"><a href="exploratory-analysis-of-time-series-data.html#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="exploratory-analysis-of-time-series-data.html#cb8-3" tabindex="-1"></a>acf_fun <span class="ot">=</span> <span class="cf">function</span>(y, k) {</span>
<span id="cb8-4"><a href="exploratory-analysis-of-time-series-data.html#cb8-4" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">cor</span>( <span class="fu">window</span>(y, <span class="at">end =</span> <span class="fu">length</span>(y)<span class="sc">-</span>k ), <span class="fu">window</span>(y,<span class="at">start =</span> k<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb8-5"><a href="exploratory-analysis-of-time-series-data.html#cb8-5" tabindex="-1"></a>}</span>
<span id="cb8-6"><a href="exploratory-analysis-of-time-series-data.html#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="exploratory-analysis-of-time-series-data.html#cb8-7" tabindex="-1"></a><span class="fu">acf_fun</span>(y,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.2144521</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="exploratory-analysis-of-time-series-data.html#cb10-1" tabindex="-1"></a>(<span class="fu">acf</span>(y, <span class="at">plot =</span> F))<span class="sc">$</span>acf[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 0.2144471</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>The partial autocorrelation function, <span class="math inline">\(\phi_k\)</span>, measures the correlation between a time series <span class="math inline">\(y_t\)</span> and a lagged copy <span class="math inline">\(y_{t-k}\)</span>, with the linear dependence of <span class="math inline">\(\{ y_{t-1}, y_{t-2}, \ldots,y_{t-k-1} \}\)</span> removed. When <span class="math inline">\(k=1\)</span>, <span class="math inline">\(\hat{\phi}_k = \hat{\rho}_k\)</span>. When <span class="math inline">\(k&gt;1\)</span>,
<span class="math display">\[\begin{align}
\hat{\phi}_k = \text{cor}(y_1 - \hat{y_1}|\{ y_2, \ldots, y_{k-1} \} , y_k - \hat{y_k}|\{ y_2, \ldots, y_{k-1} \} ),
\end{align}\]</span>
where <span class="math inline">\(\hat{y_1}|\{ y_2, \ldots, y_{k-1} \}\)</span> is the predicted <span class="math inline">\(y_1\)</span> using the linear regression where <span class="math inline">\(\{ y_2, \ldots, y_{k-1} \}\)</span> are explanatory variables.
Compute the lag 1 and 2 partial autocorrelations for the following simulated time series. Show your code and validate your answers using the <code>pacf</code> function. The <code>window</code> function may be useful to extract subsets of the time series vector.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="exploratory-analysis-of-time-series-data.html#cb12-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb12-2"><a href="exploratory-analysis-of-time-series-data.html#cb12-2" tabindex="-1"></a>ysim <span class="ot">=</span> <span class="fu">arima.sim</span>(<span class="at">n=</span><span class="dv">1000</span>, <span class="fu">list</span>(<span class="at">ar=</span><span class="fu">c</span>(.<span class="dv">5</span>)))</span>
<span id="cb12-3"><a href="exploratory-analysis-of-time-series-data.html#cb12-3" tabindex="-1"></a>(<span class="fu">pacf</span>(ysim, <span class="at">plot =</span> F))</span></code></pre></div>
<pre><code>## 
## Partial autocorrelations of series &#39;ysim&#39;, by lag
## 
##      1      2      3      4      5      6      7      8      9     10     11 
##  0.444 -0.030 -0.027 -0.026  0.011 -0.048  0.068  0.004  0.043  0.003 -0.008 
##     12     13     14     15     16     17     18     19     20     21     22 
## -0.033  0.036  0.009  0.057 -0.067 -0.030 -0.062  0.051 -0.028 -0.019 -0.043 
##     23     24     25     26     27     28     29     30 
##  0.018 -0.041  0.014 -0.014 -0.003  0.024 -0.014  0.031</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="exploratory-analysis-of-time-series-data.html#cb14-1" tabindex="-1"></a><span class="co"># lag 1 - same as the lag 1 acf</span></span>
<span id="cb14-2"><a href="exploratory-analysis-of-time-series-data.html#cb14-2" tabindex="-1"></a>y1 <span class="ot">=</span> <span class="fu">as.numeric</span>( <span class="fu">window</span>(ysim,<span class="dv">1</span>,<span class="dv">999</span>))</span>
<span id="cb14-3"><a href="exploratory-analysis-of-time-series-data.html#cb14-3" tabindex="-1"></a>y2 <span class="ot">=</span> <span class="fu">as.numeric</span>( <span class="fu">window</span>(ysim,<span class="dv">2</span>,<span class="dv">1000</span>) )</span>
<span id="cb14-4"><a href="exploratory-analysis-of-time-series-data.html#cb14-4" tabindex="-1"></a>lag1 <span class="ot">=</span> (<span class="fu">sum</span>( (y1<span class="sc">-</span><span class="fu">mean</span>(ysim)) <span class="sc">*</span> ( y2 <span class="sc">-</span> <span class="fu">mean</span>(ysim) )) )<span class="sc">/</span> <span class="fu">sum</span>( (ysim <span class="sc">-</span> <span class="fu">mean</span>(ysim))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb14-5"><a href="exploratory-analysis-of-time-series-data.html#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="exploratory-analysis-of-time-series-data.html#cb14-6" tabindex="-1"></a><span class="co"># lag 2</span></span>
<span id="cb14-7"><a href="exploratory-analysis-of-time-series-data.html#cb14-7" tabindex="-1"></a>y1 <span class="ot">=</span> <span class="fu">as.numeric</span>( <span class="fu">window</span>(ysim, <span class="dv">1</span>, <span class="dv">998</span>))</span>
<span id="cb14-8"><a href="exploratory-analysis-of-time-series-data.html#cb14-8" tabindex="-1"></a>y2 <span class="ot">=</span> <span class="fu">as.numeric</span>( <span class="fu">window</span>(ysim, <span class="dv">2</span>, <span class="dv">999</span>))</span>
<span id="cb14-9"><a href="exploratory-analysis-of-time-series-data.html#cb14-9" tabindex="-1"></a>y3 <span class="ot">=</span> <span class="fu">as.numeric</span>( <span class="fu">window</span>(ysim, <span class="dv">3</span>, <span class="dv">1000</span>))</span>
<span id="cb14-10"><a href="exploratory-analysis-of-time-series-data.html#cb14-10" tabindex="-1"></a>y1t <span class="ot">=</span> <span class="fu">residuals</span>( <span class="fu">lm</span>(y1 <span class="sc">~</span> y2))</span>
<span id="cb14-11"><a href="exploratory-analysis-of-time-series-data.html#cb14-11" tabindex="-1"></a>y3t <span class="ot">=</span> <span class="fu">residuals</span>( <span class="fu">lm</span>(y3 <span class="sc">~</span> y2))</span>
<span id="cb14-12"><a href="exploratory-analysis-of-time-series-data.html#cb14-12" tabindex="-1"></a></span>
<span id="cb14-13"><a href="exploratory-analysis-of-time-series-data.html#cb14-13" tabindex="-1"></a><span class="fu">cor</span>(y1t, y3t) <span class="co"># manual lag 2 pacf</span></span></code></pre></div>
<pre><code>## [1] -0.03019979</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="exploratory-analysis-of-time-series-data.html#cb16-1" tabindex="-1"></a>(<span class="fu">pacf</span>(ysim, <span class="at">plot =</span> F))<span class="sc">$</span>acf[<span class="dv">2</span>] <span class="co"># function lag 2 pacf</span></span></code></pre></div>
<pre><code>## [1] -0.03049528</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dbreynol/DS809/edit/master/set1.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
